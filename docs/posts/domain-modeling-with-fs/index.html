<!DOCTYPE html>
<html lang="en">
<head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script>
  
    <title>Domain Modeling With F# :: TW Blog</title>
  
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="description" content="Welcome back. Today, I am going to explain the project we are going to created, discuss all the requirements with imaginary domain experts, list all the use cases, and (finally) model the domain in F# code.
Construction Cost Estimation Project All the construction in the world, be it buildings, dams, roads or bridges. How small or large are they. All of them, starts with architecture blueprints.
No matter how beatutiful the blueprints are, the only thing matters are how much the budget is needed for that construction. This is very important since most of the owner of the building do not build the building themselves. Instead, they need to announce the project for the contractors. Each contractor need to bid in order to win the project.
" />
<meta name="keywords" content="" />

  <meta name="robots" content="noodp" />

<link rel="canonical" href="http://localhost:1313/posts/domain-modeling-with-fs/" />





  
  <link rel="stylesheet" href="http://localhost:1313/css/buttons.min.86f6b4c106b6c6eb690ae5203d36b442c1f66f718ff4e8164fa86cf6c61ad641.css">

  
  <link rel="stylesheet" href="http://localhost:1313/css/code.min.d529ea4b2fb8d34328d7d31afc5466d5f7bc2f0bc9abdd98b69385335d7baee4.css">

  
  <link rel="stylesheet" href="http://localhost:1313/css/fonts.min.5bb7ed13e1d00d8ff39ea84af26737007eb5051b157b86fc24487c94f3dc8bbe.css">

  
  <link rel="stylesheet" href="http://localhost:1313/css/footer.min.eb8dfc2c6a7eafa36cd3ba92d63e69e849e2200e0002a228d137f236b09ecd75.css">

  
  <link rel="stylesheet" href="http://localhost:1313/css/gist.min.a751e8b0abe1ba8bc53ced52a38b19d8950fe78ca29454ea8c2595cf26aad5c0.css">

  
  <link rel="stylesheet" href="http://localhost:1313/css/header.min.75c7eb0e2872d95ff48109c6647d0223a38db52e2561dd87966eb5fc7c6bdac6.css">

  
  <link rel="stylesheet" href="http://localhost:1313/css/main.min.775ac2af004d44c22a6d000fbd1d9af529642f5cef27399d0280d180af2c2e9b.css">

  
  <link rel="stylesheet" href="http://localhost:1313/css/menu.min.310d32205bdedd6f43144e3c3273c9deecd238eba5f9108db5ea96ca0cfbe377.css">

  
  <link rel="stylesheet" href="http://localhost:1313/css/pagination.min.bbb986dbce00a5ce5aca0504b7925fc1c581992a4bf57f163e5d69cc1db7d836.css">

  
  <link rel="stylesheet" href="http://localhost:1313/css/post.min.ad50c7f4d00e7975918f37fc74c6029e1959a40d66fb5b2c6564a8715e985573.css">

  
  <link rel="stylesheet" href="http://localhost:1313/css/syntax.min.e9ab635cf918bc84b901eb65c0b2caa74c9544245e3647c1af5c129896ef276e.css">

  
  <link rel="stylesheet" href="http://localhost:1313/css/terminal.min.e3b0c44298fc1c149afbf4c8996fb92427ae41e4649b934ca495991b7852b855.css">

  
  <link rel="stylesheet" href="http://localhost:1313/css/terms.min.b81791663c3790e738e571cdbf802312390d30e4b1d8dc9d814a5b5454d0ac11.css">







<link rel="shortcut icon" href="http://localhost:1313/favicon.png">
<link rel="apple-touch-icon" href="http://localhost:1313/apple-touch-icon.png">


<meta name="twitter:card" content="summary" />



<meta property="og:locale" content="en" />
<meta property="og:type" content="article" />
<meta property="og:title" content="Domain Modeling With F#">
<meta property="og:description" content="Welcome back. Today, I am going to explain the project we are going to created, discuss all the requirements with imaginary domain experts, list all the use cases, and (finally) model the domain in F# code.
Construction Cost Estimation Project All the construction in the world, be it buildings, dams, roads or bridges. How small or large are they. All of them, starts with architecture blueprints.
No matter how beatutiful the blueprints are, the only thing matters are how much the budget is needed for that construction. This is very important since most of the owner of the building do not build the building themselves. Instead, they need to announce the project for the contractors. Each contractor need to bid in order to win the project.
" />
<meta property="og:url" content="http://localhost:1313/posts/domain-modeling-with-fs/" />
<meta property="og:site_name" content="TW Blog" />

  <meta property="og:image" content="http://localhost:1313/og-image.png">

<meta property="og:image:width" content="1200">
<meta property="og:image:height" content="627">


  <meta property="article:published_time" content="2022-10-26 09:28:16 &#43;0700 &#43;07" />












</head>
<body>


<div class="container">

  <header class="header">
  <div class="header__inner">
    <div class="header__logo">
      <a href="http://localhost:1313/">
  <div class="logo">
    Terminal
  </div>
</a>

    </div>
    
    
  </div>
  
</header>


  <div class="content">
    
<article class="post">
  <h1 class="post-title">
    <a href="http://localhost:1313/posts/domain-modeling-with-fs/">Domain Modeling With F#</a>
  </h1>
  <div class="post-meta"><time class="post-date">2022-10-26</time><span class="post-author">Teerawat Wuttiwat</span></div>

  
  


  

  <div class="post-content"><div>
        <p>Welcome back. Today, I am going to explain the project we are going to created, discuss all the requirements with imaginary domain experts, list all the use cases, and (finally) model the domain in F# code.</p>
<h2 id="construction-cost-estimation-project">Construction Cost Estimation Project<a href="#construction-cost-estimation-project" class="hanchor" ariaLabel="Anchor">#</a> </h2>
<p>All the construction in the world, be it buildings, dams, roads or bridges. How small or large are they. All of them, starts with architecture blueprints.</p>
<p>No matter how beatutiful the blueprints are, the only thing matters are how much the budget is needed for that construction.
This is very important since most of the owner of the building do not build the building themselves. Instead, they need to announce the project for the contractors. Each contractor need to bid in order to win the project.</p>
<p>Hence, the project owner needs to know the budget estimation of the project. So that they will know if the bidding from the contractor make sense or not.
The larger the project, the more important the estimation of the project is.</p>
<ol>
<li>
<p>Prevent pricing scheme between contractors. in which, all contractos have a deal to propose very high estimation.</p>
</li>
<li>
<p>Check the feasibility of the project. in which, the project owner will need to check if the cost involved of the project is worthwhile or not. Usually, the owner will have their limit of budget, they might need to change blueprints in order to decrease the cost to be within the project.</p>
</li>
<li>
<p>Prevent wrong doing of estimator of project owner. The estimation if done correctly will be standardized and transparent such that there are very difficult for the estimator to have bias over specific material vendor.</p>
</li>
</ol>
<h2 id="getting-requirements">Getting Requirements<a href="#getting-requirements" class="hanchor" ariaLabel="Anchor">#</a> </h2>
<p>Without further ado, let&rsquo;s start getting into the project by discussin with domain experts. To make it fun, I will make it like conversation between the experts and me.
Here we go.</p>
<p>I usually like to start with how are the domain experts (DE) working at the moment. Usually, most of them will have Excel or paper based in placed.</p>
<p><strong>Me</strong>: Hello. Could you please explain how are you working at the moment?<br>
<strong>Expert</strong>: Sure, we are working in Construction Project Estimate Department. Usually, we will get input as <strong>blueprint</strong> and <strong>spec book</strong> from architureture department. We then <strong>decode</strong> the blueprint into <strong>Bill Of Quantity (BoQ)</strong> which usually is an Excel file. We sum up the <strong>cost for each BoQ Item</strong> to get the <strong>direct cost</strong> of the project. We then look up for <strong>Factor F</strong> using the direct cost. Finally, we multiply the Factor with the direct cost to get the <strong>estimated cost of the prject</strong>.</p>
<p>Phew, I think to myself that quite a lot of domain jargon which I have no idea. I highlight each jargon to clarify each of them in detail.</p>
<p><strong>Me</strong>: There are many words that I do not understand yet. Could you please clarify one by one. Let&rsquo;s start with <strong>blueprint</strong>.
<strong>Expert</strong>: Ok, the <strong>blueprint</strong> is what the architecture draw construction in detail to give you construction sub-contractor to build. We also use the same blueprint to calculate or in our term, decoding, to Bill of Quantity (BoQ).
<strong>Me</strong>: Could you show me the example of <strong>Bill of Quantity (BoQ)</strong>. Let&rsquo;s keep it short by referring it as BoQ then.
Expert: Yes, we usually refer that way. Here is what it looks like. <strong>BoQ</strong> of the project is the list of work that need to be done to finish the project. The work is itemized as <strong>BoQ Item</strong>. Each item will contain <strong>materials</strong>, <strong>labors</strong>, and their <strong>cost</strong>. Here is how it looks like:</p>
<table>
  <thead>
      <tr>
          <th>No.</th>
          <th>Work Description</th>
          <th>Quantity</th>
          <th>Unit</th>
          <th>Material</th>
          <th>Material Unit Cost</th>
          <th>Labor</th>
          <th>Labor Unit Cost</th>
          <th>Item Cost</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>1</td>
          <td>Pool Tiling</td>
          <td>10</td>
          <td>m^2</td>
          <td>Big Tile</td>
          <td>100</td>
          <td>Do Tiling</td>
          <td>50</td>
          <td>1500</td>
      </tr>
  </tbody>
</table>
<p>I remind myself that this looks like <em>Data</em> which can be defined using F# <em>Record</em>
Anyway, there are more to that, we should confirm about calculation of total cost:</p>
<p><strong>Me</strong>: Can I assume that the <strong>Item Cost</strong> is the summation of Material Cost and Labor Cost.</p>
<p><strong>Expert</strong>: Yes, it is just like that. To get <strong>Material Cost</strong>, you just need to multiply <strong>Quantity</strong> with <strong>Material Unit Cost</strong>. Same goes with Labor Cost. In the case of Pool Tiling above, the Material Cost = 10 * 100 = 1000 and the Labor Cost = 10 * 50 = 500. Hence, the <strong>Item Cost</strong> is 1000 + 500 = 1500.</p>
<p><strong>Me</strong>: How about the <strong>Unit</strong>? Do we have to specify <strong>Unit</strong> for Material and Labor?</p>
<p><strong>Expert</strong>: Not needed at the moment. You just need to make sure that both Unit Cost must use the same <strong>Unit</strong> per money (Thai Baht in this case). For example, the Material Unit Cost for Pool Tiling is 100 m^2 / baht and Labor Unit Cost is 50 m^2 / bath. It is very important though that conversion is needed to make sure that <strong>Unit</strong> is correct.</p>
<p>Here is our first formula - <strong>Item Cost Calculation</strong></p>
<pre><code>ItemCost = Quantity * MaterialUnitCost + Quantity * LaborUnitCost
</code></pre>
<p>I think we are ready to create our first function now. Open up your VSCode, create new fsi, names it scratch.fsx and write down following snippet:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fsharp" data-lang="fsharp"><span style="display:flex;"><span><span style="color:#66d9ef">let</span> calcItemCost qty materialUnitCost laborUnitCost <span style="color:#f92672">=</span> 
</span></span><span style="display:flex;"><span>  qty <span style="color:#f92672">*</span> materialUnitCost <span style="color:#f92672">+</span> qty <span style="color:#f92672">*</span> laborUnitCost
</span></span></code></pre></div><p>This is very naive sketch for this function. We can do better. Let think about what errors can occur in this situation.</p>
<ol>
<li>User is confused between quantity and unit cost since both are float.</li>
<li>User is confused between material and labor unit cost.</li>
<li>User is confused between unit of quantity and unit cost since none of them are provided.</li>
</ol>
<p>We will improve the code iteratively. Start with the first item.</p>
<ol>
<li>User is confused between quantity and unit cost since both are float.</li>
</ol>
<p>We can enforce this by introducing single discriminated union type to Quantity and UnitCost and requires the types of input of calcItemCost function</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fsharp" data-lang="fsharp"><span style="display:flex;"><span><span style="color:#66d9ef">type</span> <span style="color:#a6e22e">Quantity</span> <span style="color:#f92672">=</span> Quantity <span style="color:#66d9ef">of</span> <span style="color:#66d9ef">float</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">type</span> <span style="color:#a6e22e">UnitCost</span> <span style="color:#f92672">=</span> UnitCost <span style="color:#66d9ef">of</span> <span style="color:#66d9ef">float</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">let</span> calcItemCost <span style="color:#f92672">(</span>Quantity qty<span style="color:#f92672">)</span> <span style="color:#f92672">(</span>UnitCost materialUnitCost<span style="color:#f92672">)</span> <span style="color:#f92672">(</span>UnitCost laborUnitCost<span style="color:#f92672">)</span> <span style="color:#f92672">=</span>  
</span></span><span style="display:flex;"><span>  qty <span style="color:#f92672">*</span> materialUnitCost <span style="color:#f92672">+</span> qty <span style="color:#f92672">*</span> laborUnitCost
</span></span></code></pre></div><ol start="2">
<li>User is confused between material and labor unit cost.</li>
</ol>
<p>Again, we can use type to enforce this by introducing MaterialUnitCost and LaborUnitCost types.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fsharp" data-lang="fsharp"><span style="display:flex;"><span><span style="color:#66d9ef">type</span> <span style="color:#a6e22e">MaterialUnitCost</span> <span style="color:#f92672">=</span> Material <span style="color:#66d9ef">of</span> UnitCost
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">type</span> <span style="color:#a6e22e">LaborUnitCost</span> <span style="color:#f92672">=</span> Labor <span style="color:#66d9ef">of</span> UnitCost
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">let</span> calcItemCost quantity materialUnitCost laborUnitCost <span style="color:#f92672">=</span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">match</span> quantity<span style="color:#f92672">,</span> materialUnitCost<span style="color:#f92672">,</span> laborUnitCost <span style="color:#66d9ef">with</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">|</span> <span style="color:#f92672">(</span>Quantity qty<span style="color:#f92672">),</span> <span style="color:#f92672">(</span>Material <span style="color:#f92672">(</span>UnitCost materialUnitCost&#39;<span style="color:#f92672">)),</span> <span style="color:#f92672">(</span>Labor <span style="color:#f92672">(</span>UnitCost laborUnitCost&#39;<span style="color:#f92672">))</span> <span style="color:#f92672">-&gt;</span>
</span></span><span style="display:flex;"><span>    qty <span style="color:#f92672">*</span> materialUnitCost&#39; <span style="color:#f92672">+</span> qty <span style="color:#f92672">*</span> laborUnitCost&#39;
</span></span></code></pre></div><p>As you can see, I decide to use match to extract actual values of material and labor unitcost.</p>
<ol start="3">
<li>User is confused between unit of quantity and unit cost since none of them are provided.</li>
</ol>
<p>We just need to introduce Unit for both Quantity and Material and make sure that when we calculate the item cost, it will check if both of them are the same. Here is the code.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fsharp" data-lang="fsharp"><span style="display:flex;"><span><span style="color:#66d9ef">type</span> <span style="color:#a6e22e">Quantity</span> <span style="color:#f92672">=</span> Quantity <span style="color:#66d9ef">of</span> <span style="color:#66d9ef">float</span><span style="color:#f92672">*</span><span style="color:#66d9ef">string</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">type</span> <span style="color:#a6e22e">UnitCost</span> <span style="color:#f92672">=</span> 
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>    Name<span style="color:#f92672">:</span> <span style="color:#66d9ef">string</span>
</span></span><span style="display:flex;"><span>    UnitCost<span style="color:#f92672">:</span> <span style="color:#66d9ef">float</span>
</span></span><span style="display:flex;"><span>    Unit<span style="color:#f92672">:</span> <span style="color:#66d9ef">string</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">type</span> <span style="color:#a6e22e">MaterialUnitCost</span> <span style="color:#f92672">=</span> Material <span style="color:#66d9ef">of</span> UnitCost
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">type</span> <span style="color:#a6e22e">LaborUnitCost</span> <span style="color:#f92672">=</span> Labor <span style="color:#66d9ef">of</span> UnitCost
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">let</span> tryCalcItemCost <span style="color:#f92672">(</span>Quantity <span style="color:#f92672">(</span>qty<span style="color:#f92672">,</span>qtyUnit<span style="color:#f92672">))</span> <span style="color:#f92672">(</span>Material materialUnitCost<span style="color:#f92672">)</span> <span style="color:#f92672">(</span>Labor laborUnitCost<span style="color:#f92672">)</span> <span style="color:#f92672">=</span>  
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">if</span> qtyUnit <span style="color:#f92672">=</span> materialUnitCost<span style="color:#f92672">.</span>Unit <span style="color:#f92672">&amp;&amp;</span> qtyUnit <span style="color:#f92672">=</span> laborUnitCost<span style="color:#f92672">.</span>Unit <span style="color:#66d9ef">then</span> 
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">(</span>qty <span style="color:#f92672">*</span> materialUnitCost<span style="color:#f92672">.</span>UnitCost <span style="color:#f92672">+</span> qty <span style="color:#f92672">*</span> laborUnitCost<span style="color:#f92672">.</span>UnitCost<span style="color:#f92672">)</span> <span style="color:#f92672">|&gt;</span> Some
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">else</span>
</span></span><span style="display:flex;"><span>    None
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">let</span> testCalcItemCost <span style="color:#f92672">=</span> 
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">let</span> materialUnitCost <span style="color:#f92672">=</span> Material <span style="color:#f92672">{</span> Name <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;Big Tile&#34;</span><span style="color:#f92672">;</span> UnitCost <span style="color:#f92672">=</span> 100<span style="color:#f92672">;</span> Unit <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;m2&#34;</span> <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">let</span> laborUnitCost <span style="color:#f92672">=</span> Labor <span style="color:#f92672">{</span> Name <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;Do Tiling&#34;</span><span style="color:#f92672">;</span> UnitCost <span style="color:#f92672">=</span> 50<span style="color:#f92672">;</span> Unit <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;m2&#34;</span> <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>  tryCalcItemCost <span style="color:#f92672">(</span>Quantity <span style="color:#f92672">(</span>10<span style="color:#f92672">,</span> <span style="color:#e6db74">&#34;m2&#34;</span><span style="color:#f92672">))</span> materialUnitCost laborUnitCost <span style="color:#f92672">=</span> Some 1500 
</span></span></code></pre></div><p>I change the name of calcItemCost to tryCalcItemCost since we are going to return Option of float as result. When the input of calculation invalid (i.e. unit is not equal), we will return None.</p>
<p>Usually, when we start to have some non-trivial function, I will create test function in the fsx file. F# protect us for most error, but sometimes Unit Testing is necessary.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fsharp" data-lang="fsharp"><span style="display:flex;"><span><span style="color:#66d9ef">type</span> <span style="color:#a6e22e">BoQItem</span> <span style="color:#f92672">=</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>    OrderNo<span style="color:#f92672">:</span> int
</span></span><span style="display:flex;"><span>    Description<span style="color:#f92672">:</span> <span style="color:#66d9ef">string</span>
</span></span><span style="display:flex;"><span>    Quantity<span style="color:#f92672">:</span> <span style="color:#66d9ef">float</span>
</span></span><span style="display:flex;"><span>    Unit<span style="color:#f92672">:</span> <span style="color:#66d9ef">string</span>
</span></span><span style="display:flex;"><span>    Material<span style="color:#f92672">:</span> <span style="color:#66d9ef">string</span>
</span></span><span style="display:flex;"><span>    MaterialUnitCost<span style="color:#f92672">:</span> <span style="color:#66d9ef">float</span>
</span></span><span style="display:flex;"><span>    Labor<span style="color:#f92672">:</span> <span style="color:#66d9ef">string</span>
</span></span><span style="display:flex;"><span>    LaborUnitCost<span style="color:#f92672">:</span> <span style="color:#66d9ef">float</span>        
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">let</span> calcItemCost item <span style="color:#f92672">=</span> 
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">(</span>item<span style="color:#f92672">.</span>Quantity <span style="color:#f92672">*</span> item<span style="color:#f92672">.</span>MaterialUnitCost<span style="color:#f92672">)</span> <span style="color:#f92672">+</span> <span style="color:#f92672">(</span>item<span style="color:#f92672">.</span>Quantity <span style="color:#f92672">*</span> item<span style="color:#f92672">.</span>LaborUnitCost<span style="color:#f92672">)</span>  
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#e6db74">/// Test 
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">/// 
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"></span><span style="color:#66d9ef">let</span> poolItem <span style="color:#f92672">=</span> 
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">{</span> 
</span></span><span style="display:flex;"><span>    OrderNo <span style="color:#f92672">=</span> 1
</span></span><span style="display:flex;"><span>    Description <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;Pool Tiling&#34;</span>
</span></span><span style="display:flex;"><span>    Quantity <span style="color:#f92672">=</span> 10
</span></span><span style="display:flex;"><span>    Unit <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;m^2&#34;</span>
</span></span><span style="display:flex;"><span>    Material <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;Big Tile&#34;</span>
</span></span><span style="display:flex;"><span>    MaterialUnitCost <span style="color:#f92672">=</span> 100
</span></span><span style="display:flex;"><span>    Labor <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;Do Tiling&#34;</span>
</span></span><span style="display:flex;"><span>    LaborUnitCost <span style="color:#f92672">=</span> 50
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">let</span> testCalcItemCost <span style="color:#f92672">=</span> <span style="color:#f92672">(</span>calcItemCost poolItem<span style="color:#f92672">)</span> <span style="color:#f92672">=</span> 1500
</span></span></code></pre></div><p>The function is done. We will go to next task, implementing <strong>BoQItem</strong>. From the way BoQItem is represented, I think it is more appropriated to implement in Record type.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fsharp" data-lang="fsharp"><span style="display:flex;"><span><span style="color:#66d9ef">type</span> <span style="color:#a6e22e">BoQItem</span> <span style="color:#f92672">=</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>    Description <span style="color:#f92672">:</span> <span style="color:#66d9ef">string</span>
</span></span><span style="display:flex;"><span>    Quantity <span style="color:#f92672">:</span> Quantity
</span></span><span style="display:flex;"><span>    MaterialUnitCost <span style="color:#f92672">:</span> MaterialUnitCost
</span></span><span style="display:flex;"><span>    LaborUnitCost <span style="color:#f92672">:</span> LaborUnitCost
</span></span><span style="display:flex;"><span>    TotalCost <span style="color:#f92672">:</span> <span style="color:#66d9ef">float</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">}</span>
</span></span></code></pre></div><p>The new TotalCost field should always include up-to-date <strong>Item Cost</strong>. To enforce this, we need to make sure that whenever new BoQItem is created, TotalCost will be calculated and update. This can be done by make the type private to module. Here is the code:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fsharp" data-lang="fsharp"><span style="display:flex;"><span><span style="color:#66d9ef">type</span> <span style="color:#a6e22e">BoQItem</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">private</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">//...Same as above
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">module</span> BoQItem <span style="color:#f92672">=</span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">let</span> tryCalcItemCost <span style="color:#f92672">(</span>Quantity <span style="color:#f92672">(</span>qty<span style="color:#f92672">,</span>qtyUnit<span style="color:#f92672">))</span> <span style="color:#f92672">(</span>Material materialUnitCost<span style="color:#f92672">)</span> <span style="color:#f92672">(</span>Labor laborUnitCost<span style="color:#f92672">)</span> <span style="color:#f92672">=</span>  
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> qtyUnit <span style="color:#f92672">=</span> materialUnitCost<span style="color:#f92672">.</span>Unit <span style="color:#f92672">&amp;&amp;</span> qtyUnit <span style="color:#f92672">=</span> laborUnitCost<span style="color:#f92672">.</span>Unit <span style="color:#66d9ef">then</span> 
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">(</span>qty <span style="color:#f92672">*</span> materialUnitCost<span style="color:#f92672">.</span>UnitCost <span style="color:#f92672">+</span> qty <span style="color:#f92672">*</span> laborUnitCost<span style="color:#f92672">.</span>UnitCost<span style="color:#f92672">)</span> <span style="color:#f92672">|&gt;</span> Some
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">else</span>
</span></span><span style="display:flex;"><span>      None
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">let</span> tryCreate desc qty materialUnitCost laborUnitCost <span style="color:#f92672">=</span>
</span></span><span style="display:flex;"><span>    tryCalcItemCost qty materialUnitCost laborUnitCost
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">|&gt;</span> Option.map <span style="color:#f92672">(</span><span style="color:#66d9ef">fun</span> cost <span style="color:#f92672">-&gt;</span> 
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>        Description <span style="color:#f92672">=</span> desc
</span></span><span style="display:flex;"><span>        Quantity <span style="color:#f92672">=</span> qty
</span></span><span style="display:flex;"><span>        MaterialUnitCost <span style="color:#f92672">=</span> materialUnitCost
</span></span><span style="display:flex;"><span>        LaborUnitCost <span style="color:#f92672">=</span> laborUnitCost
</span></span><span style="display:flex;"><span>        TotalCost <span style="color:#f92672">=</span> cost
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">)</span> 
</span></span></code></pre></div><p>Users will want to update BoQItem, we should create CRUD operation on the BoQItem type.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fsharp" data-lang="fsharp"><span style="display:flex;"><span>  <span style="color:#66d9ef">let</span> updateDesc newDesc item <span style="color:#f92672">=</span> <span style="color:#f92672">{</span> item <span style="color:#66d9ef">with</span> Description <span style="color:#f92672">=</span> newDesc <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">let</span> tryUpdateQty newQty item <span style="color:#f92672">=</span> 
</span></span><span style="display:flex;"><span>    tryCalcItemCost newQty item<span style="color:#f92672">.</span>MaterialUnitCost item<span style="color:#f92672">.</span>LaborUnitCost
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">|&gt;</span> Option.map <span style="color:#f92672">(</span><span style="color:#66d9ef">fun</span> cost <span style="color:#f92672">-&gt;</span> 
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>        item <span style="color:#66d9ef">with</span>
</span></span><span style="display:flex;"><span>          Quantity <span style="color:#f92672">=</span> newQty
</span></span><span style="display:flex;"><span>          TotalCost <span style="color:#f92672">=</span> cost
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">})</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">let</span> tryUpdateMaterialUnitCost <span style="color:#f92672">(</span>Material newUnitCost<span style="color:#f92672">)</span> item <span style="color:#f92672">=</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">let</span> newMaterialUnitCost <span style="color:#f92672">=</span> Material newUnitCost
</span></span><span style="display:flex;"><span>    tryCalcItemCost item<span style="color:#f92672">.</span>Quantity newMaterialUnitCost item<span style="color:#f92672">.</span>LaborUnitCost
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">|&gt;</span> Option.map <span style="color:#f92672">(</span><span style="color:#66d9ef">fun</span> cost <span style="color:#f92672">-&gt;</span> 
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>        item <span style="color:#66d9ef">with</span>
</span></span><span style="display:flex;"><span>          MaterialUnitCost <span style="color:#f92672">=</span> newMaterialUnitCost
</span></span><span style="display:flex;"><span>          TotalCost <span style="color:#f92672">=</span> cost
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">})</span>
</span></span></code></pre></div><p>Here, we create update function for Description, Quantity, and MaterialUnitCost. Since both Quantity and MaterialUnitCost can have some invalid result (i.e. Units are not matched.), both will return Option type.
Let&rsquo;s create functions for testing this CRUD operations.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fsharp" data-lang="fsharp"><span style="display:flex;"><span><span style="color:#66d9ef">let</span> poolItem <span style="color:#f92672">=</span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">let</span> qty <span style="color:#f92672">=</span> Quantity <span style="color:#f92672">(</span>10<span style="color:#f92672">,</span> <span style="color:#e6db74">&#34;m^2&#34;</span><span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">let</span> materialUnitCost <span style="color:#f92672">=</span> Material <span style="color:#f92672">{</span> Name <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;Big Tile&#34;</span><span style="color:#f92672">;</span> UnitCost <span style="color:#f92672">=</span> 100<span style="color:#f92672">;</span> Unit <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;m^2&#34;</span> <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">let</span> laborUnitCost <span style="color:#f92672">=</span> Labor <span style="color:#f92672">{</span> Name <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;Do Tiling&#34;</span><span style="color:#f92672">;</span> UnitCost <span style="color:#f92672">=</span> 50<span style="color:#f92672">;</span> Unit <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;m^2&#34;</span> <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>  tryCreate <span style="color:#e6db74">&#34;Pool Tile&#34;</span>  qty materialUnitCost laborUnitCost
</span></span><span style="display:flex;"><span> 
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">let</span> testUpdateDesc <span style="color:#f92672">=</span> 
</span></span><span style="display:flex;"><span>  poolItem 
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">|&gt;</span> Option.map <span style="color:#f92672">(</span>updateDesc <span style="color:#e6db74">&#34;New Pool&#34;</span><span style="color:#f92672">)</span> 
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">|&gt;</span> Option.map <span style="color:#f92672">(</span><span style="color:#66d9ef">fun</span> x <span style="color:#f92672">-&gt;</span> x<span style="color:#f92672">.</span>Description <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;New Pool&#34;</span><span style="color:#f92672">)</span> 
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">|&gt;</span> Option.defaultValue <span style="color:#66d9ef">false</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">let</span> testUpdateQty <span style="color:#f92672">=</span> 
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">let</span> newQty <span style="color:#f92672">=</span> Quantity <span style="color:#f92672">(</span>20<span style="color:#f92672">,</span><span style="color:#e6db74">&#34;m^2&#34;</span><span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>  poolItem 
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">|&gt;</span> Option.bind <span style="color:#f92672">(</span>tryUpdateQty  newQty<span style="color:#f92672">)</span> 
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">|&gt;</span> Option.map <span style="color:#f92672">(</span><span style="color:#66d9ef">fun</span> x <span style="color:#f92672">-&gt;</span> x<span style="color:#f92672">.</span>TotalCost <span style="color:#f92672">=</span> 3000<span style="color:#f92672">)</span> 
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">|&gt;</span> Option.defaultValue <span style="color:#66d9ef">false</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">let</span> testUpdateMaterialUnitCost <span style="color:#f92672">=</span> 
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">let</span> newMaterialUnitCost <span style="color:#f92672">=</span> 
</span></span><span style="display:flex;"><span>    Material <span style="color:#f92672">&lt;|</span> <span style="color:#f92672">{</span> Name <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;Small Tile&#34;</span><span style="color:#f92672">;</span> UnitCost <span style="color:#f92672">=</span> 50<span style="color:#f92672">;</span> Unit <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;m^2&#34;</span><span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>  poolItem 
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">|&gt;</span> Option.bind <span style="color:#f92672">(</span>tryUpdateMaterialUnitCost  newMaterialUnitCost<span style="color:#f92672">)</span> 
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">|&gt;</span> Option.map <span style="color:#f92672">(</span><span style="color:#66d9ef">fun</span> x <span style="color:#f92672">-&gt;</span> x<span style="color:#f92672">.</span>TotalCost <span style="color:#f92672">=</span> 1000<span style="color:#f92672">)</span> 
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">|&gt;</span> Option.defaultValue <span style="color:#66d9ef">false</span>
</span></span></code></pre></div><p>I found that combining lots of Option related functions together makes the code hard to read. I decide to use <strong>maybe</strong> computation expression to make the code more succint.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fsharp" data-lang="fsharp"><span style="display:flex;"><span><span style="color:#66d9ef">type</span> <span style="color:#a6e22e">MaybeBuilder</span>() <span style="color:#f92672">=</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">member</span> this.<span style="color:#a6e22e">Bind</span><span style="color:#f92672">(</span>x<span style="color:#f92672">,</span> f<span style="color:#f92672">)</span> <span style="color:#f92672">=</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">match</span> x <span style="color:#66d9ef">with</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">|</span> None <span style="color:#f92672">-&gt;</span> None
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">|</span> Some a <span style="color:#f92672">-&gt;</span> f a
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">member</span> this.<span style="color:#a6e22e">Return</span><span style="color:#f92672">(</span>x<span style="color:#f92672">)</span> <span style="color:#f92672">=</span>
</span></span><span style="display:flex;"><span>    Some x
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">let</span> maybe <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> MaybeBuilder()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">let</span> testUpdateDesc <span style="color:#f92672">=</span> 
</span></span><span style="display:flex;"><span>  maybe <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">let!</span> poolItem<span style="color:#66d9ef">&#39;</span> <span style="color:#f92672">=</span> poolItem
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">let</span> updatedPoolItem <span style="color:#f92672">=</span> updateDesc <span style="color:#e6db74">&#34;New Pool&#34;</span> poolItem&#39;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> updatedPoolItem<span style="color:#f92672">.</span>Description <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;New Pool&#34;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">|&gt;</span> Option.defaultValue <span style="color:#66d9ef">false</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">let</span> testUpdateQty <span style="color:#f92672">=</span> 
</span></span><span style="display:flex;"><span>  maybe <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">let!</span> poolItem<span style="color:#66d9ef">&#39;</span> <span style="color:#f92672">=</span> poolItem
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">let</span> newQty <span style="color:#f92672">=</span> Quantity <span style="color:#f92672">(</span>20<span style="color:#f92672">,</span><span style="color:#e6db74">&#34;m^2&#34;</span><span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">let!</span> updatedPoolItem <span style="color:#f92672">=</span> tryUpdateQty newQty poolItem&#39;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> updatedPoolItem<span style="color:#f92672">.</span>TotalCost <span style="color:#f92672">=</span> 3000
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">|&gt;</span> Option.defaultValue <span style="color:#66d9ef">false</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">let</span> testUpdateMaterialUnitCost <span style="color:#f92672">=</span> 
</span></span><span style="display:flex;"><span>  maybe <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">let!</span> poolItem<span style="color:#66d9ef">&#39;</span> <span style="color:#f92672">=</span> poolItem
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">let</span> newMaterialUnitCost <span style="color:#f92672">=</span> Material <span style="color:#f92672">&lt;|</span> <span style="color:#f92672">{</span> Name <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;Small Tile&#34;</span><span style="color:#f92672">;</span> UnitCost <span style="color:#f92672">=</span> 50<span style="color:#f92672">;</span> Unit <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;m^2&#34;</span><span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">let!</span> updatedPoolItem <span style="color:#f92672">=</span> tryUpdateMaterialUnitCost newMaterialUnitCost poolItem&#39;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> updatedPoolItem<span style="color:#f92672">.</span>TotalCost <span style="color:#f92672">=</span> 1000
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">|&gt;</span> Option.defaultValue <span style="color:#66d9ef">false</span>
</span></span></code></pre></div><p>The number of lines might be almost the same but the meaning of codes are clearer.</p>
<p>I think we are halfway through the domain modeling now. I will go sip some coffee before continuing. Also, it&rsquo;s a good idea to show the result of test especially the calculation one to the client.</p>
<p>Ok, we finish the coffee. The next thing is to calculate the <strong>Estimate Cost</strong> of the construction project.
We start by showing the calculation to the expert to confirm our understanding:</p>
<pre><code>EstimateCost = DirectCost * FactorF
</code></pre>
<p>The main calculation is very simple. We need to go from there one bye one.</p>
<pre><code>DirectCost = Summation of BoQItem Cost
</code></pre>
<p>This one is easy. We can write the code as follow.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fsharp" data-lang="fsharp"><span style="display:flex;"><span><span style="color:#66d9ef">type</span> <span style="color:#a6e22e">DirectCost</span> <span style="color:#f92672">=</span> DirectCost <span style="color:#66d9ef">of</span> <span style="color:#66d9ef">float</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">let</span> calcDirectCost items <span style="color:#f92672">=</span> 
</span></span><span style="display:flex;"><span>  items 
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">|&gt;</span> List.sumBy <span style="color:#f92672">(</span><span style="color:#66d9ef">fun</span> a <span style="color:#f92672">-&gt;</span> a <span style="color:#f92672">|&gt;</span> value <span style="color:#f92672">|&gt;</span> <span style="color:#f92672">(</span><span style="color:#66d9ef">fun</span> b <span style="color:#f92672">-&gt;</span> b<span style="color:#f92672">.</span>TotalCost<span style="color:#f92672">))</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">|&gt;</span> DirectCost
</span></span></code></pre></div><p>Note that we create new simple type for DirectCost to make it different from normal float type.</p>
<p>Next is <strong>FactorF</strong>, we do not know how to get this. It&rsquo;s time to talk with the Expert.</p>
<p><strong>Me</strong>: We know that <strong>FactorF</strong> is important in estimating the cost but we have no idea how to get it. Could you please shed some light?</p>
<p><strong>Expert</strong>: Easy. There is a table lookup for <strong>FactorF</strong> provided by the government. All you need to do is <strong>look up</strong> using <strong>Direct Cost</strong> of your project.</p>
<p><strong>Me</strong>:  Can you show me how to lookup?
<strong>Expert</strong>: Sure. Here is a sample of <strong>FactorF Table</strong>.</p>
<table>
  <thead>
      <tr>
          <th>Direct Cost</th>
          <th>Factor F</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>&lt; 10</td>
          <td>1.1</td>
      </tr>
      <tr>
          <td>10 &lt;= x &lt;= 100</td>
          <td>1.5</td>
      </tr>
      <tr>
          <td>&gt; 100</td>
          <td>1.9</td>
      </tr>
  </tbody>
</table>
<p>If your project direct cost is less than 10 then the Factor F will be 1.1 but if is greater than 100 then it will be 1.9.
Things will get more complicated when the cost is between 10 and 100. We call this as in <strong>Bound</strong>. You need to get proportion of your direct cost and multiply that to range of factor f. It&rsquo;s mouthful. Let&rsquo;s show the expert the formula.</p>
<pre><code>BoundFactorF = DirectCostRatio * FactorFRange + LowerBoundF
DirectCostRatio = (DirectCost - LowerBoundCost) /(UpperBoundCost - LowerBoundCost) 
FactorFRange = UpperBoundF - LowerBoundF
</code></pre>
<p>Let&rsquo;s try out the formular for DirectCost of 55.</p>
<pre><code>FactorFRange = 1.5 - 1.1 = 0.4
DirectCostRatio = (55 - 10) / (100 - 10 ) = 0.5
BoundFactorF = 0.5 * 0.4 + 1.1 = 1.3
</code></pre>
<p>Let&rsquo;s convert this formula to f#</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fsharp" data-lang="fsharp"><span style="display:flex;"><span><span style="color:#66d9ef">let</span> calcBoundF lowerBound upperBound directCost <span style="color:#f92672">=</span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">let</span> lowerBoundCost<span style="color:#f92672">,</span>lowerBoundF <span style="color:#f92672">=</span> lowerBound
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">let</span> upperBoundCost<span style="color:#f92672">,</span>upperBoundF <span style="color:#f92672">=</span> upperBound
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">let</span> fRange <span style="color:#f92672">=</span> upperBoundF <span style="color:#f92672">-</span> lowerBoundF
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">let</span> costRatio <span style="color:#f92672">=</span> <span style="color:#f92672">(</span>directCost <span style="color:#f92672">-</span> lowerBoundCost<span style="color:#f92672">)</span> <span style="color:#f92672">/</span> <span style="color:#f92672">(</span>upperBoundCost <span style="color:#f92672">-</span> lowerBoundCost<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>  costRatio <span style="color:#f92672">*</span> fRange <span style="color:#f92672">+</span> lowerBoundF
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">let</span> testCalcBoundF <span style="color:#f92672">=</span> <span style="color:#f92672">(=)</span> <span style="color:#f92672">(</span>calcBoundF <span style="color:#f92672">(</span>10<span style="color:#f92672">.</span>0<span style="color:#f92672">,</span>1<span style="color:#f92672">.</span>1<span style="color:#f92672">)</span> <span style="color:#f92672">(</span>100<span style="color:#f92672">.</span>0<span style="color:#f92672">,</span>1<span style="color:#f92672">.</span>5<span style="color:#f92672">)</span> 55<span style="color:#f92672">.</span>0<span style="color:#f92672">)</span> 1<span style="color:#f92672">.</span>3 
</span></span></code></pre></div><p>Next, we will take care of DirectCost which exceed either minimum or maximum bound. The FactorF table is simply defined as a list of two float tuple. The firt is cost and the second is factor f. For example, the example table can de defined as follow:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fsharp" data-lang="fsharp"><span style="display:flex;"><span><span style="color:#66d9ef">let</span> exampleFTable <span style="color:#f92672">=</span> 
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">(</span> <span style="color:#f92672">(</span>10<span style="color:#f92672">.</span>0<span style="color:#f92672">,</span> 1<span style="color:#f92672">.</span>1<span style="color:#f92672">);</span> <span style="color:#f92672">(</span>100<span style="color:#f92672">.</span>0<span style="color:#f92672">,</span> 1<span style="color:#f92672">.</span>5<span style="color:#f92672">);</span> <span style="color:#f92672">(</span>1000<span style="color:#f92672">,</span> 1<span style="color:#f92672">.</span>9<span style="color:#f92672">)</span> <span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">|&gt;</span> FactorFTable
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fsharp" data-lang="fsharp"><span style="display:flex;"><span><span style="color:#66d9ef">type</span> <span style="color:#a6e22e">FactorFTable</span> <span style="color:#f92672">=</span> FactorFTable <span style="color:#66d9ef">of</span> <span style="color:#66d9ef">float</span><span style="color:#f92672">*</span><span style="color:#66d9ef">float</span> <span style="color:#66d9ef">list</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">let</span> calcFactorF <span style="color:#f92672">(</span>FactorFTable fTable<span style="color:#f92672">)</span> <span style="color:#f92672">(</span>DirectCost directCost<span style="color:#f92672">)</span> <span style="color:#f92672">=</span> 
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">let</span> findBound() <span style="color:#f92672">=</span> 
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">let</span> lowerBoundIndex <span style="color:#f92672">=</span> 
</span></span><span style="display:flex;"><span>      fTable 
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">|&gt;</span> List.findIndexBack <span style="color:#f92672">(</span><span style="color:#66d9ef">fun</span> <span style="color:#f92672">(</span>cost<span style="color:#f92672">,_)</span> <span style="color:#f92672">-&gt;</span> directCost <span style="color:#f92672">&gt;</span> cost<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">let</span> upperBoundIndex <span style="color:#f92672">=</span> lowerBoundIndex <span style="color:#f92672">+</span> 1
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">(</span>fTable <span style="color:#f92672">|&gt;</span> List.item lowerBoundIndex<span style="color:#f92672">),</span> <span style="color:#f92672">(</span>fTable <span style="color:#f92672">|&gt;</span> List.item upperBoundIndex<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">let</span> <span style="color:#f92672">(</span>minCost<span style="color:#f92672">,</span> minF<span style="color:#f92672">),</span> <span style="color:#f92672">(</span>maxCost<span style="color:#f92672">,</span> maxF<span style="color:#f92672">)</span> <span style="color:#f92672">=</span> <span style="color:#f92672">(</span>fTable <span style="color:#f92672">|&gt;</span> List.head<span style="color:#f92672">),</span> <span style="color:#f92672">(</span>fTable <span style="color:#f92672">|&gt;</span> List.last<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">if</span> directCost <span style="color:#f92672">&lt;</span> minCost <span style="color:#66d9ef">then</span> minF
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">else</span> <span style="color:#66d9ef">if</span> directCost <span style="color:#f92672">&gt;</span> maxCost <span style="color:#66d9ef">then</span> maxF
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">else</span> 
</span></span><span style="display:flex;"><span>    findBound()
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">|&gt;</span> calcBoundF
</span></span></code></pre></div><p>We have all the ingredients, let combine everything to our main function <strong>etimateCost</strong>.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fsharp" data-lang="fsharp"><span style="display:flex;"><span><span style="color:#66d9ef">let</span> applyFactorF loadFactorFTable <span style="color:#f92672">(</span>DirectCost directCost<span style="color:#f92672">)</span> <span style="color:#f92672">=</span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">let</span> factorF <span style="color:#f92672">=</span> calcFactorF loadFactorFTable()
</span></span><span style="display:flex;"><span>  directCost <span style="color:#f92672">*</span> factorF
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">let</span> roundCost <span style="color:#f92672">=</span> <span style="color:#66d9ef">function</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">|</span> a <span style="color:#66d9ef">when</span> a <span style="color:#f92672">&lt;</span> 1000<span style="color:#f92672">.</span>0 <span style="color:#f92672">-&gt;</span> a 
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">|</span> b <span style="color:#f92672">-&gt;</span>
</span></span><span style="display:flex;"><span>    b <span style="color:#f92672">/</span> 1000<span style="color:#f92672">.</span>0
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">|&gt;</span> System.Math.Truncate
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">|&gt;</span> <span style="color:#f92672">(*)</span> 1000<span style="color:#f92672">.</span>0
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">let</span> estimateCost loadFactorFTable <span style="color:#f92672">=</span>
</span></span><span style="display:flex;"><span>  calcDirectCost <span style="color:#f92672">&gt;&gt;</span> <span style="color:#f92672">(</span>applyFactorF loadFactorFTable<span style="color:#f92672">)</span> <span style="color:#f92672">&gt;&gt;</span> roundCost
</span></span></code></pre></div><p>We have introduced 3 functions here. Function applyFactorF is like the name apply FactorF to DirectCost. Function loadFactorFTable is an input to the function so we can test the applyFactorF without really using any persistence layer. For example here is the example function</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fsharp" data-lang="fsharp"><span style="display:flex;"><span><span style="color:#66d9ef">let</span> testFactorFTable () <span style="color:#f92672">=</span> 
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">(</span> <span style="color:#f92672">(</span>10<span style="color:#f92672">.</span>0<span style="color:#f92672">,</span> 1<span style="color:#f92672">.</span>1<span style="color:#f92672">);</span> <span style="color:#f92672">(</span>100<span style="color:#f92672">.</span>0<span style="color:#f92672">,</span> 1<span style="color:#f92672">.</span>5<span style="color:#f92672">);</span> <span style="color:#f92672">(</span>1000<span style="color:#f92672">,</span> 1<span style="color:#f92672">.</span>9<span style="color:#f92672">)</span> <span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">|&gt;</span> FactorFTable
</span></span></code></pre></div><p>The roundCost function is just function to strip the number after thousand digit. The last function estimate cost use combination to combine all small functions together.</p>
<p>We have finish ourt first use case</p>
<pre><code>1. Estimate construction cost
</code></pre>
<p>All the code can be clone from <a href="https://github.com/twuttiwat/CoCoTender">https://github.com/twuttiwat/CoCoTender</a> using tag v0.1.1</p>
<p>Or you can use following command</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>git clone -b v0.1.1 https://github.com/twuttiwat/CoCoTender.git
</span></span></code></pre></div><p>Next, we will growing this use case from this simple fsharp script to full-blown webapp. Stay Tune!</p>

      </div></div>

  

  
    

  
</article>

  </div>

  
    <footer class="footer">
  <div class="footer__inner">
    
      <div class="copyright">
        <span> 2025 Powered by <a href="https://gohugo.io">Hugo</a></span>
    
      <span>:: <a href="https://github.com/panr/hugo-theme-terminal" target="_blank">Theme</a> made by <a href="https://github.com/panr" target="_blank">panr</a></span>
      </div>
  </div>
</footer>






<script type="text/javascript" src="/bundle.min.js"></script>





  
</div>

</body>
</html>
